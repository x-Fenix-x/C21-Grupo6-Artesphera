<div class="overflow-y-auto border-l border-black text-gray-800 pl-5">
    <table class="table-auto w-full">
        <thead>
            <tr class="border-b border-black">
                <th class="py-3">#</th>
                <th class="py-3">Producto</th>
                <th class="py-3">CategorÃ­a</th>
                <th class="py-3">Precio</th>
                <th class="py-3">Desc.</th>
                <th class="py-3">P. Final</th>
                <th class="py-3">Acciones</th>
            </tr>
        </thead>
        <tbody class="text-[16.5px]">
            <% products.forEach((product, index)=> { %>
                <tr class="border-b border-gray-400">
                    <td class="font-bold px-3">
                        <%= index + 1%>
                    </td>
                    <td class="p-1">
                        <%= product.title %>
                    </td>
                    <td class="p-1">
                        <%= product.category.name %>
                    </td>
                    <td class="p-1">
                        <%= product.price %>
                    </td>
                    <td class="p-1">
                        <%= product.discount%>%
                    </td>
                    <td class="p-1">
                        <%= priceFinal(product.price ,product.discount)%>
                    </td>
                    <td class="p-1">
                        <div class="flex gap-2 items-center">
                            <a href="/products/detail/<%= product.id %>" class="fa-regular fa-eye text-gray-700"></a>
                            <a href="/products/edit/<%= product.id %>"
                                class="fa-regular fa-pen-to-square text-gray-700"></a>
                            <form id="deleteForm<%= product.id %>">
                                <button type="button" class="fa-regular fa-trash-can text-gray-700"
                                    onclick="showDeleteConfirmation('<%= product.title %>', '<%= product.id %>')"></button>
                            </form>
                        </div>
                    </td>
                    <% }) %>
                </tr>
        </tbody>
    </table>

    <script>
        function showDeleteConfirmation(productTitle, productId) {
            const swalWithBootstrapButtons = Swal.mixin({
                customClass: {
                    confirmButton: "btn btn-success",
                    cancelButton: "btn btn-danger"
                },
                buttonsStyling: false
            });

            swalWithBootstrapButtons.fire({
                title: "Â¿EstÃ¡s seguro?",
                text: `Â¿EstÃ¡s seguro de que deseas eliminar el producto "${productTitle}"?`,
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "SÃ­, eliminarlo",
                cancelButtonText: "No, cancelar",
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch(`/products/delete/${productId}?_method=DELETE`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                swalWithBootstrapButtons.fire({
                                    title: "Â¡Eliminado!",
                                    text: `El producto "${productTitle}" ha sido eliminado.`,
                                    icon: "success"
                                }).then(() => {
                                    window.location.reload(true);
                                });
                            } else {
                                swalWithBootstrapButtons.fire({
                                    title: "Error",
                                    text: "Error al eliminar el producto.",
                                    icon: "error"
                                });
                            }
                        })
                        .catch(error => {
                            console.error(error);
                            swalWithBootstrapButtons.fire({
                                title: "Error",
                                text: "Error al comunicarse con el servidor.",
                                icon: "error"
                            });
                        });
                } else if (result.dismiss === Swal.DismissReason.cancel) {
                    swalWithBootstrapButtons.fire({
                        title: "Cancelado",
                        text: `El producto "${productTitle}" estÃ¡ a salvo ðŸŽ„âœ¨`,
                        icon: "error"
                    });
                }
            });
        }
    </script>
</div>